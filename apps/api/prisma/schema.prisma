generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum RequestStatus {
  open
  in_progress
  done
}

model Client {
  id         Int              @id @default(autoincrement())
  telegramId String           @unique @map("telegram_id")
  username   String?
  firstName  String?          @map("first_name")
  lastName   String?          @map("last_name")
  createdAt  DateTime         @default(now()) @map("created_at")
  requests   ShipmentRequest[]

  @@map("clients")
}

model Manager {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  name         String
  passwordHash String   @map("password_hash")
  createdAt    DateTime @default(now()) @map("created_at")

  @@map("managers")
}

model ShipmentRequest {
  id          Int                    @id @default(autoincrement())
  clientId    Int                    @map("client_id")
  city        String
  deliveryDate DateTime             @map("delivery_date")
  size        String
  weight      Float
  boxCount    Int                    @map("box_count")
  comment     String?
  status      RequestStatus          @default(open)
  createdAt   DateTime               @default(now()) @map("created_at")
  updatedAt   DateTime               @updatedAt @map("updated_at")

  client      Client                 @relation(fields: [clientId], references: [id])
  history     RequestStatusHistory[]

  @@map("shipment_requests")
}

model DeliverySchedule {
  id            Int      @id @default(autoincrement())
  destination   String
  deliveryDate  DateTime @map("delivery_date")
  acceptDays    String   @map("accept_days")
  createdAt     DateTime @default(now()) @map("created_at")

  @@map("delivery_schedules")
}

model RequestStatusHistory {
  id        Int           @id @default(autoincrement())
  requestId Int           @map("request_id")
  oldStatus RequestStatus @map("old_status")
  newStatus RequestStatus @map("new_status")
  changedAt DateTime      @default(now()) @map("changed_at")

  request   ShipmentRequest @relation(fields: [requestId], references: [id])

  @@map("request_status_history")
}
